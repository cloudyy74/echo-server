# Echo Server FIFO

Это простая программа на C, реализующая эхо-сервер с использованием именованного канала (FIFO). Программа может работать как в foreground-режиме (с выводом информации в консоль), так и в режиме демона (с логированием в файл), что определяется параметрами командной строки.

## Обработка сигналов

  Программа устойчиво работает при получении различных сигналов:
  - **SIGINT:** Завершает работу, дочитывая текущий FIFO до конца (гладкое завершение).
  - **SIGTERM:** Завершает работу немедленно, игнорируя оставшиеся данные в канале.
  - **SIGHUP:** В foreground-режиме переводит программу в режим демона (с логированием в файл) с выводом статистики в лог.
  - **SIGALRM:** Каждые заданное время выводит диагностическое сообщение с текущей статистикой.
  - **SIGUSR1:** При получении выводит статистику по количеству обработанных сообщений, объёму данных и числу срабатываний будильника.
  - **SIGQUIT:** Игнорируется.

## Статистика
Программа считает количество циклов открытия FIFO (сообщений), общее число прочитанных байт и количество срабатываний будильника. Итоговая статистика выводится при получении сигнала SIGUSR1 и при завершении работы.

## Требования

- Компилятор C (поддерживающий стандарт C99)
- POSIX-совместимая система (например, Linux)

## Инструкции по сборке

Скомпилировать программу можно следующим образом:
```
$ make
```
Запускается с флагами:
```
$ ./echo_server [flags]
```
где флаги:
* `-d`: режим демона,
* `-t <N>`: частота SIGALRM в секундах (по умолчанию 15),
* `-f <path>`: имя fifo канала (по умолчанию /tmp/echo_server.fifo),
* `-l <path>`: имя log файла (по умолчанию /tmo/echo_server.log).

Флаги могут указываться в любом порядке.

## Примеры использования

```
$ ./echo_server                      ## ждём 15 секунд             
diag msg: waiting for data           ## echo "test" > /tmp/echo_server.fifo
test                                 ## через ещё 15 секунд
diag msg: waiting for data           ## kill -USR1 <pid> 
msg: 1, bytes: 5, alarm count: 2     ## kill -HUP <pid>
```

Основной процесс завершился, теперь программа работает в режиме демона и пишет в /tmp/echo_server.log

```
$ echo "test after daemonize" > /tmp/echo_server.fifo
$ kill -USR1 <pid>
$ kill -INT <pid>
$ cat /tmp/echo_server.log
daemonize by signhup
msg: 1, bytes: 5, alarm count: 2
test after daemonize
msg: 2, bytes: 26, alarm count: 2
exiting
msg: 2, bytes: 26, alarm count: 2
```

Теперь попробуем запустится сразу в режиме демона, и отправим в канал сразу файлы посредством cat

```
$ ./echo_server -d -f daemon.fifo -l daemon.log
$ cat test.txt > daemon.fifo
$ kill -USR1 <pid>
$ kill <pid>
$ cat daemon.log
diag msg: waiting for data
nice message
very nice message
msg: 2, bytes: 31, alarm count: 1
diag msg: waiting for data
exiting
msg: 2, bytes: 31, alarm count: 2
```
